name: Build Default

on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build Default Image
        run: |
          start_time=$(date +%s)
          docker build -f build/default/Dockerfile -t default-image .
          end_time=$(date +%s)
          echo "BUILD_TIME=$((end_time - start_time))" >> $GITHUB_ENV

      - name: Get Image Size
        run: |
          size=$(docker images default-image --format "{{.Size}}")
          echo "IMAGE_SIZE=$size" >> $GITHUB_ENV

      - name: Output Metrics
        run: |
          echo "=== Metrics ==="
          echo "Build Time: ${{ env.BUILD_TIME }} seconds"
          echo "Image Size: ${{ env.IMAGE_SIZE }}"

          echo "### Build Metrics :rocket:" >> $GITHUB_STEP_SUMMARY
          echo "| Metric | Value |" >> $GITHUB_STEP_SUMMARY
          echo "| :--- | :--- |" >> $GITHUB_STEP_SUMMARY
          echo "| Build Time | ${{ env.BUILD_TIME }} seconds |" >> $GITHUB_STEP_SUMMARY
          echo "| Image Size | ${{ env.IMAGE_SIZE }} |" >> $GITHUB_STEP_SUMMARY
